#Backup GLPI Proxmox

#Identifique o volume:
#Pegar o ID
Bash
docker volume ls
6dc6b906caa0

#Pegar o vulume do container:
Bash
docker inspect <nome_do_container_ou_id> | grep "Mounts" -A 5 
docker inspect 6dc6b906caa0 | grep "Mounts" -A 5

#Crie um container temporário para o backup:
Bash
docker run --rm --volumes-from <nome_do_container> -v $(pwd):/backup ubuntu tar cvf /backup/backup_volume_<nome_do_volume>_$(date +%Y%m%d).tar /caminho/do/volume/dentro/do/container
docker run --rm -v e93b6c8dd674048d99a9a1bdabc7a4ae182ad421ebaf1634eaa1bbcbdcb5772d:/glpi_data -v $(pwd):/backup ubuntu tar cvf /backup/backup_glpi_$(date +%Y%m%d).tar /glpi_data

#Irá criar uma arquivo .tar com o backup do volume especificado.


--------------------------------------------

#Backup GLPI Produção
#Pegar o ID
Bash
sudo docker ps
5f3b1783aaef

#Pegar o vulume do container:
Bash
docker inspect <nome_do_container_ou_id> | grep "Mounts" -A 5 
docker inspect 5f3b1783aaef | grep "Mounts" -A 5 

#Criar diretório na pasta do usuário logado no ubuntu:
Bash
mkdir ~/glpi_bkp

#Backup dos arquivos do GLPI de Produção para dentro da pasta do usuário logado no ubuntu:
Bash
tar cvf ~/glpi_bkp/glpi_files_$(date +%Y%m%d).tar /dados/data/glpi/glpi-10

------------------------------------------

#Restauração do Backup do GLPI

#Copiar o arquivo .tar de backup criado para dentro da psta /glpi_bkp
#Usar o WinSCP, se pedir permissão de root, usar o comando:
Bash
sudo chmod 777 glpi_bkp

#Pare o container do GLPI
Bash
docker stop glpi-app

#Comando de Restauração para o Volume Nomeado
#Agora, use um container temporário para descompactar o backup diretamente para o volume:
Bash
docker run --rm -v e93b6c8dd674048d99a9a1bdabc7a4ae182ad421ebaf1634eaa1bbcbdcb5772d:/var/glpi_destino -v ~/glpi_bkp:/backup ubuntu bash -c "tar xvf /backup/glpi_files_20250730.tar -C /var/glpi_destino --strip-components=1"

#Após a Restauração inicie o container do GLPI:
Bash
docker start glpi-app

-------------------------------------

#Concede todas as permissões no banco de dados 'nome_do_banco' para este usuário
GRANT ALL PRIVILEGES ON glpidb.* TO 'adminag'@'%';

#IMPORTANTE: Recarrega as tabelas de privilégios para que as alterações entrem em vigor imediatamente.
FLUSH PRIVILEGES;



